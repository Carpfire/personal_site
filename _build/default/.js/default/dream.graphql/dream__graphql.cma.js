// Generated by js_of_ocaml
//# buildInfo:effects=false, kind=cma, use-js-string=true, version=5.6.0

//# unitInfo: Provides: Dream__graphql
(function
  (globalThis){
   "use strict";
   var runtime = globalThis.jsoo_runtime, Dream_graphql = [0];
   runtime.caml_register_global(0, Dream_graphql, "Dream__graphql");
   return;
  }
  (globalThis));

//# unitInfo: Provides: Dream__graphql__Graphql
//# unitInfo: Requires: CamlinternalLazy, Dream__graphiql, Dream__server__Helpers, Dream__server__Log, Dream_pure__Message, Dream_pure__Method, Dream_pure__Stream, Graphql_lwt, Graphql_parser, Lwt, Lwt_stream, Stdlib__Hashtbl, Stdlib__Option, Stdlib__Printexc, Stdlib__String, Str, Yojson__Basic
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_s = "%s",
    cst_Content_Type_not_applicati = "Content-Type not 'application/json'",
    cst_Duplicate_connection_init = "Duplicate connection_init",
    cst_Exception_while_handling_W =
      "Exception while handling WebSocket message:",
    cst_GraphQL_WebSocket_closed_b = "GraphQL WebSocket closed by client",
    cst_GraphQL_message_is_not_JSO = "GraphQL message is not JSON",
    cst_GraphQL_message_lacks_a_ty = "GraphQL message lacks a type",
    cst_If_intentional_please_open =
      "If intentional, please open an issue about supporting this",
    cst_Sec_WebSocket_Protocol$0 = "Sec-WebSocket-Protocol",
    cst_Upgrade_websocket_header_m = "Upgrade: websocket header missing",
    cst_client_complete_operation_ = "client complete: operation id missing",
    cst_complete = "complete",
    cst_complete_before_connection = "complete before connection_init",
    cst_errors$1 = "errors",
    cst_graphql_transport_ws = "graphql-transport-ws",
    cst_https_github_com_aantron_d = "https://github.com/aantron/dream/issues",
    cst_id$3 = "id",
    cst_payload$2 = "payload",
    cst_subscribe_before_connectio = "subscribe before connection_init",
    cst_subscribe_duplicate_operat = "subscribe: duplicate operation id",
    cst_subscribe_operation_id_mis = "subscribe: operation id missing",
    cst_type$0 = "type",
    caml_maybe_attach_backtrace = runtime.caml_maybe_attach_backtrace,
    caml_string_notequal = runtime.caml_string_notequal,
    caml_wrap_exception = runtime.caml_wrap_exception;
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   function caml_call3(f, a0, a1, a2){
    return (f.l >= 0 ? f.l : f.l = f.length) == 3
            ? f(a0, a1, a2)
            : runtime.caml_call_gen(f, [a0, a1, a2]);
   }
   function caml_call4(f, a0, a1, a2, a3){
    return (f.l >= 0 ? f.l : f.l = f.length) == 4
            ? f(a0, a1, a2, a3)
            : runtime.caml_call_gen(f, [a0, a1, a2, a3]);
   }
   function caml_call5(f, a0, a1, a2, a3, a4){
    return (f.l >= 0 ? f.l : f.l = f.length) == 5
            ? f(a0, a1, a2, a3, a4)
            : runtime.caml_call_gen(f, [a0, a1, a2, a3, a4]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    cst = "",
    CamlinternalLazy = global_data.CamlinternalLazy,
    Dream_server_Helpers = global_data.Dream__server__Helpers,
    Dream_graphiql = global_data.Dream__graphiql,
    Str = global_data.Str,
    Stdlib_String = global_data.Stdlib__String,
    Dream_pure_Method = global_data.Dream_pure__Method,
    Yojson_Basic = global_data.Yojson__Basic,
    Lwt = global_data.Lwt,
    Dream_pure_Message = global_data.Dream_pure__Message,
    Dream_pure_Stream = global_data.Dream_pure__Stream,
    Stdlib_Hashtbl = global_data.Stdlib__Hashtbl,
    Lwt_stream = global_data.Lwt_stream,
    Stdlib_Printexc = global_data.Stdlib__Printexc,
    Dream_server_Log = global_data.Dream__server__Log,
    Graphql_lwt = global_data.Graphql_lwt,
    Stdlib_Option = global_data.Stdlib__Option,
    Graphql_parser = global_data.Graphql_parser,
    log = caml_call2(Dream_server_Log[19], 0, "dream.graphql"),
    cst_ENDPOINT = "%%ENDPOINT%%",
    cst_DEFAULT_QUERY = "%%DEFAULT_QUERY%%",
    _M_ =
      [0,
       [11, cst_https_github_com_aantron_d, 0],
       cst_https_github_com_aantron_d],
    _L_ =
      [0,
       [11, cst_If_intentional_please_open, 0],
       cst_If_intentional_please_open],
    _K_ =
      [0,
       [11, "GraphQL endpoint route '", [2, 0, [11, "' contains '\"'", 0]]],
       "GraphQL endpoint route '%s' contains '\"'"],
    _I_ =
      [0,
       [11, "Method ", [2, 0, [11, "; must be GET or POST", 0]]],
       "Method %s; must be GET or POST"],
    _D_ =
      [0,
       [11, cst_Upgrade_websocket_header_m, 0],
       cst_Upgrade_websocket_header_m],
    _G_ =
      [0,
       [11, cst_Content_Type_not_applicati, 0],
       cst_Content_Type_not_applicati],
    cst_Subscriptions_and_streamin =
      "Subscriptions and streaming should use WebSocket transport",
    cst_Content_Type = "Content-Type",
    _H_ = [0, -949323947],
    cst_Upgrade = "Upgrade",
    cst_Sec_WebSocket_Protocol = cst_Sec_WebSocket_Protocol$0,
    _F_ =
      [0, [0, [0, cst_Sec_WebSocket_Protocol$0, cst_graphql_transport_ws], 0]],
    _E_ = [0, -36502890],
    _J_ = [0, -36502890],
    _C_ =
      [0,
       [11, cst_GraphQL_WebSocket_closed_b, 0],
       cst_GraphQL_WebSocket_closed_b],
    _A_ =
      [0,
       [11, cst_GraphQL_message_lacks_a_ty, 0],
       cst_GraphQL_message_lacks_a_ty],
    _h_ =
      [0,
       [11, "Unknown WebSocket message type '", [2, 0, [12, 39, 0]]],
       "Unknown WebSocket message type '%s'"],
    _w_ =
      [0,
       [11, cst_client_complete_operation_, 0],
       cst_client_complete_operation_],
    _y_ =
      [0,
       [11, cst_complete_before_connection, 0],
       cst_complete_before_connection],
    _u_ =
      [0,
       [11, cst_Duplicate_connection_init, 0],
       cst_Duplicate_connection_init],
    _q_ =
      [0,
       [11, cst_subscribe_operation_id_mis, 0],
       cst_subscribe_operation_id_mis],
    _p_ = [0, [11, "subscribe: error ", [2, 0, 0]], "subscribe: error %s"],
    _o_ =
      [0, [11, "Subscription: error ", [2, 0, 0]], "Subscription: error %s"],
    _m_ =
      [0,
       [11, cst_subscribe_duplicate_operat, 0],
       cst_subscribe_duplicate_operat],
    _n_ = [0, 4409],
    cst_Internal_Server_Error = "Internal Server Error",
    _l_ = [0, [2, 0, 0], cst_s],
    _k_ = [0, [2, 0, 0], cst_s],
    _j_ =
      [0,
       [11, cst_Exception_while_handling_W, 0],
       cst_Exception_while_handling_W],
    _s_ =
      [0,
       [11, cst_subscribe_before_connectio, 0],
       cst_subscribe_before_connectio],
    _f_ =
      [0,
       [11, cst_GraphQL_message_is_not_JSO, 0],
       cst_GraphQL_message_is_not_JSO],
    _e_ = [0, [11, "Message '", [2, 0, [12, 39, 0]]], "Message '%s'"],
    _g_ = [0, 4400],
    cst_type = cst_type$0,
    _t_ = [0, 4401],
    cst_payload$1 = cst_payload$2,
    _r_ = [0, 4400],
    _v_ = [0, 4429],
    _z_ = [0, 4401],
    _x_ = [0, 4400],
    _i_ = [0, 4400],
    _B_ = [0, 4400],
    cst_id$2 = cst_id$3,
    _d_ = [0, cst_type$0, [0, -976970511, cst_complete]],
    cst_errors$0 = cst_errors$1,
    cst_payload$0 = cst_payload$2,
    cst_id$1 = cst_id$3,
    _c_ = [0, cst_type$0, [0, -976970511, "error"]],
    cst_payload = cst_payload$2,
    cst_id$0 = cst_id$3,
    _b_ = [0, cst_type$0, [0, -976970511, "next"]],
    cst_id = cst_id$3,
    cst_query = "query",
    cst_operationName = "operationName",
    cst_variables = "variables",
    cst_No_query = "No query",
    cst_message = "message",
    cst_errors = cst_errors$1,
    _a_ =
      [0,
       963043957,
       [0, [0, cst_type$0, [0, -976970511, "connection_ack"]], 0]];
   function make_error(message){
    return [0,
            963043957,
            [0,
             [0,
              cst_errors,
              [0,
               848054398,
               [0,
                [0,
                 963043957,
                 [0, [0, cst_message, [0, -976970511, message]], 0]],
                0]]],
             0]];
   }
   function run_query(make_context, schema, request, json){
    var
     _bi_ = caml_call1(caml_call1(Yojson_Basic[96][6], cst_query), json),
     query = caml_call1(Yojson_Basic[96][22], _bi_),
     _bj_ =
       caml_call1(caml_call1(Yojson_Basic[96][6], cst_operationName), json),
     operation_name = caml_call1(Yojson_Basic[96][22], _bj_),
     _bk_ = caml_call1(caml_call1(Yojson_Basic[96][6], cst_variables), json),
     variables = caml_call1(Stdlib_Option[2], _bk_);
    if(! query){
     var _bp_ = [1, make_error(cst_No_query)];
     return caml_call1(Lwt[4], _bp_);
    }
    var query$0 = query[1], match = caml_call1(Graphql_parser[1], query$0);
    if(0 !== match[0]){
     var message = match[1], _bo_ = [1, make_error(message)];
     return caml_call1(Lwt[4], _bo_);
    }
    var query$1 = match[1];
    a:
    {
     if(variables){
      var json$0 = variables[1];
      if(typeof json$0 !== "number" && 963043957 === json$0[1]){
       var
        _bn_ = caml_call1(Yojson_Basic[96][10], json$0),
        variables$0 = caml_call1(Stdlib_Option[2], _bn_);
       break a;
      }
     }
     var variables$0 = 0;
    }
    var ppx_lwt_0 = caml_call1(make_context, request);
    function _bl_(context){
     return caml_call5
             (Graphql_lwt[1][24],
              schema,
              context,
              variables$0,
              operation_name,
              query$1);
    }
    function _bm_(exn){
     try{throw caml_maybe_attach_backtrace(exn, 0);}
     catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
    }
    return caml_call3(Lwt[81], _bm_, ppx_lwt_0, _bl_);
   }
   function operation_id(json){
    var _bh_ = caml_call1(caml_call1(Yojson_Basic[96][6], cst_id), json);
    return caml_call1(Yojson_Basic[96][22], _bh_);
   }
   function close_and_clean(code, subscriptions, websocket){
    var ppx_lwt_0 = caml_call2(Dream_pure_Message[33], code, websocket);
    function _be_(param){
     function _bg_(param, close){return caml_call1(close, 0);}
     caml_call2(Stdlib_Hashtbl[12], _bg_, subscriptions);
     return Lwt[36];
    }
    function _bf_(exn){
     try{throw caml_maybe_attach_backtrace(exn, 0);}
     catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
    }
    return caml_call3(Lwt[81], _bf_, ppx_lwt_0, _be_);
   }
   var ack_message = caml_call5(Yojson_Basic[1], 0, 0, 0, 0, _a_);
   function data_message(id, payload){
    return caml_call5
            (Yojson_Basic[1],
             0,
             0,
             0,
             0,
             [0,
              963043957,
              [0,
               _b_,
               [0,
                [0, cst_id$0, [0, -976970511, id]],
                [0, [0, cst_payload, payload], 0]]]]);
   }
   function error_message(id, json){
    var
     _bd_ =
       [0,
        963043957,
        [0,
         _c_,
         [0,
          [0, cst_id$1, [0, -976970511, id]],
          [0,
           [0,
            cst_payload$0,
            caml_call1(caml_call1(Yojson_Basic[96][6], cst_errors$0), json)],
           0]]]];
    return caml_call5(Yojson_Basic[1], 0, 0, 0, 0, _bd_);
   }
   function complete_message(id){
    return caml_call5
            (Yojson_Basic[1],
             0,
             0,
             0,
             0,
             [0,
              963043957,
              [0, _d_, [0, [0, cst_id$2, [0, -976970511, id]], 0]]]);
   }
   function handle_over_websocket
   (make_context, schema, subscriptions, request, websocket){
    function loop(inited){
     function _ao_(exn){throw caml_maybe_attach_backtrace(exn, 0);}
     function _ap_(param){
      if(! param){
       var _aE_ = function(log){return caml_call2(log, [0, request], _C_);};
       caml_call1(log[3], _aE_);
       return close_and_clean(0, subscriptions, websocket);
      }
      var message = param[1];
      function _ar_(log){return caml_call3(log, [0, request], _e_, message);}
      caml_call1(log[4], _ar_);
      try{var json = caml_call4(Yojson_Basic[33], 0, 0, 0, message);}
      catch(_bc_){
       var _as_ = function(log){return caml_call2(log, [0, request], _f_);};
       caml_call1(log[2], _as_);
       return close_and_clean(_g_, subscriptions, websocket);
      }
      var
       _at_ = caml_call1(caml_call1(Yojson_Basic[96][6], cst_type), json),
       match = caml_call1(Yojson_Basic[96][22], _at_);
      if(! match){
       var _aD_ = function(log){return caml_call2(log, [0, request], _A_);};
       caml_call1(log[2], _aD_);
       return close_and_clean(_B_, subscriptions, websocket);
      }
      var message_type = match[1];
      if(! caml_string_notequal(message_type, cst_complete)){
       if(! inited){
        var _aC_ = function(log){return caml_call2(log, [0, request], _y_);};
        caml_call1(log[2], _aC_);
        return close_and_clean(_z_, subscriptions, websocket);
       }
       var match$1 = operation_id(json);
       if(! match$1){
        var _aB_ = function(log){return caml_call2(log, [0, request], _w_);};
        caml_call1(log[2], _aB_);
        return close_and_clean(_x_, subscriptions, websocket);
       }
       var
        id$0 = match$1[1],
        match$2 = caml_call2(Stdlib_Hashtbl[7], subscriptions, id$0);
       if(match$2){var close = match$2[1]; caml_call1(close, 0);}
       return loop(inited);
      }
      if(caml_string_notequal(message_type, "connection_init")){
       if(caml_string_notequal(message_type, "subscribe")){
        var
         _au_ =
           function(log){
            return caml_call3(log, [0, request], _h_, message_type);
           };
        caml_call1(log[2], _au_);
        return close_and_clean(_i_, subscriptions, websocket);
       }
       if(! inited){
        var _ax_ = function(log){return caml_call2(log, [0, request], _s_);};
        caml_call1(log[2], _ax_);
        return close_and_clean(_t_, subscriptions, websocket);
       }
       var match$0 = operation_id(json);
       if(match$0){
        var
         id = match$0[1],
         payload =
           caml_call1(caml_call1(Yojson_Basic[96][6], cst_payload$1), json),
         _av_ =
           function(param){
            var subscribed = [0, 0];
            function _aF_(exn){
             var backtrace = caml_call1(Stdlib_Printexc[6], 0);
             function _a3_(log){return caml_call2(log, [0, request], _j_);}
             caml_call1(log[1], _a3_);
             function _a4_(log){
              return caml_call3
                      (log,
                       [0, request],
                       _k_,
                       caml_call1(Stdlib_Printexc[1], exn));
             }
             caml_call1(log[1], _a4_);
             function _a5_(line){
              function _bb_(log){
               return caml_call3(log, [0, request], _l_, line);
              }
              return caml_call1(log[1], _bb_);
             }
             caml_call1(caml_call1(Dream_server_Log[21], _a5_), backtrace);
             function _a6_(param){return Lwt[36];}
             function _a7_(param){
              var
               _a9_ = error_message(id, make_error(cst_Internal_Server_Error)),
               ppx_lwt_0 =
                 caml_call4(Dream_server_Helpers[20], 0, 0, websocket, _a9_);
              function _a__(param){
               if(! subscribed[1]) return Lwt[36];
               var _ba_ = complete_message(id);
               return caml_call4
                       (Dream_server_Helpers[20], 0, 0, websocket, _ba_);
              }
              function _a$_(exn){
               try{throw caml_maybe_attach_backtrace(exn, 0);}
               catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
              }
              return caml_call3(Lwt[81], _a$_, ppx_lwt_0, _a__);
             }
             function _a8_(exn){
              try{throw caml_maybe_attach_backtrace(exn, 0);}
              catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
             }
             return caml_call3(Lwt[82], _a8_, _a7_, _a6_);
            }
            function _aG_(param){
             function _aI_(exn){throw caml_maybe_attach_backtrace(exn, 0);}
             function _aJ_(param){
              if(0 !== param[0]){
               var
                json$0 = param[1],
                _aS_ =
                  function(log){
                   return caml_call3
                           (log,
                            [0, request],
                            _p_,
                            caml_call5(Yojson_Basic[1], 0, 0, 0, 0, json$0));
                  };
               caml_call1(log[2], _aS_);
               var _aT_ = error_message(id, json$0);
               return caml_call4
                       (Dream_server_Helpers[20], 0, 0, websocket, _aT_);
              }
              var match = param[1];
              if(-71406943 <= match[1]){
               var
                json = match[2],
                _aL_ = data_message(id, json),
                ppx_lwt_0 =
                  caml_call4(Dream_server_Helpers[20], 0, 0, websocket, _aL_),
                _aM_ =
                  function(param){
                   var
                    _a0_ = complete_message(id),
                    ppx_lwt_0 =
                      caml_call4(Dream_server_Helpers[20], 0, 0, websocket, _a0_);
                   function _a1_(param){return Lwt[36];}
                   function _a2_(exn){
                    try{throw caml_maybe_attach_backtrace(exn, 0);}
                    catch(exn){
                     var exn$0 = caml_wrap_exception(exn);
                     return exn$0;
                    }
                   }
                   return caml_call3(Lwt[81], _a2_, ppx_lwt_0, _a1_);
                  },
                _aN_ =
                  function(exn){
                   try{throw caml_maybe_attach_backtrace(exn, 0);}
                   catch(exn){
                    var exn$0 = caml_wrap_exception(exn);
                    return exn$0;
                   }
                  };
               return caml_call3(Lwt[81], _aN_, ppx_lwt_0, _aM_);
              }
              var match$0 = match[2], close = match$0[2], stream = match$0[1];
              if(caml_call2(Stdlib_Hashtbl[9], subscriptions, id)){
               var
                _aO_ =
                  function(log){return caml_call2(log, [0, request], _m_);};
               caml_call1(log[2], _aO_);
               return close_and_clean(_n_, subscriptions, websocket);
              }
              caml_call3(Stdlib_Hashtbl[11], subscriptions, id, close);
              subscribed[1] = 1;
              function _aP_(param){
               if(0 === param[0]){
                var json = param[1], _aX_ = data_message(id, json);
                return caml_call4
                        (Dream_server_Helpers[20], 0, 0, websocket, _aX_);
               }
               var json$0 = param[1];
               function _aY_(log){
                return caml_call3
                        (log,
                         [0, request],
                         _o_,
                         caml_call5(Yojson_Basic[1], 0, 0, 0, 0, json$0));
               }
               caml_call1(log[2], _aY_);
               var _aZ_ = error_message(id, json$0);
               return caml_call4
                       (Dream_server_Helpers[20], 0, 0, websocket, _aZ_);
              }
              var
               ppx_lwt_0$0 =
                 caml_call1(caml_call1(Lwt_stream[51], _aP_), stream);
              function _aQ_(param){
               var
                _aU_ = complete_message(id),
                ppx_lwt_0 =
                  caml_call4(Dream_server_Helpers[20], 0, 0, websocket, _aU_);
               function _aV_(param){
                caml_call2(Stdlib_Hashtbl[10], subscriptions, id);
                return Lwt[36];
               }
               function _aW_(exn){
                try{throw caml_maybe_attach_backtrace(exn, 0);}
                catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;
                }
               }
               return caml_call3(Lwt[81], _aW_, ppx_lwt_0, _aV_);
              }
              function _aR_(exn){
               try{throw caml_maybe_attach_backtrace(exn, 0);}
               catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
              }
              return caml_call3(Lwt[81], _aR_, ppx_lwt_0$0, _aQ_);
             }
             function _aK_(param){
              return run_query(make_context, schema, request, payload);
             }
             return caml_call3(Lwt[9], _aK_, _aJ_, _aI_);
            }
            function _aH_(exn){
             try{throw caml_maybe_attach_backtrace(exn, 0);}
             catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
            }
            return caml_call3(Lwt[82], _aH_, _aG_, _aF_);
           };
        caml_call1(Lwt[11], _av_);
        return loop(inited);
       }
       var _aw_ = function(log){return caml_call2(log, [0, request], _q_);};
       caml_call1(log[2], _aw_);
       return close_and_clean(_r_, subscriptions, websocket);
      }
      if(inited){
       var _ay_ = function(log){return caml_call2(log, [0, request], _u_);};
       caml_call1(log[2], _ay_);
       return close_and_clean(_v_, subscriptions, websocket);
      }
      var
       ppx_lwt_0 =
         caml_call4(Dream_server_Helpers[20], 0, 0, websocket, ack_message);
      function _az_(param){return loop(1);}
      function _aA_(exn){
       try{throw caml_maybe_attach_backtrace(exn, 0);}
       catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
      }
      return caml_call3(Lwt[81], _aA_, ppx_lwt_0, _az_);
     }
     function _aq_(param){
      return caml_call1(Dream_server_Helpers[18], websocket);
     }
     return caml_call3(Lwt[9], _aq_, _ap_, _ao_);
    }
    return loop(0);
   }
   function graphql(make_context, schema, request){
    var method = caml_call1(Dream_pure_Message[2], request);
    if(typeof method === "number"){
     if(3546230 === method){
      var
       upgrade = caml_call2(Dream_pure_Message[9], request, cst_Upgrade),
       protocol =
         caml_call2
          (Dream_pure_Message[9], request, cst_Sec_WebSocket_Protocol);
      if
       (upgrade
        &&
         !
         caml_string_notequal(upgrade[1], "websocket")
         &&
          protocol
          && ! caml_string_notequal(protocol[1], cst_graphql_transport_ws)){
       var
        ___ = caml_call2(Stdlib_Hashtbl[1], 0, 16),
        _$_ =
          function(_an_){
           return handle_over_websocket
                   (make_context, schema, ___, request, _an_);
          };
       return caml_call3(Dream_server_Helpers[17], _F_, 0, _$_);
      }
      var _Y_ = function(log){return caml_call2(log, [0, request], _D_);};
      caml_call1(log[2], _Y_);
      var
       _Z_ =
         caml_call5
          (Dream_pure_Message[6],
           _E_,
           0,
           0,
           Dream_pure_Stream[8],
           Dream_pure_Stream[7]);
      return caml_call1(Lwt[4], _Z_);
     }
     if(891112544 === method){
      var
       match = caml_call2(Dream_pure_Message[9], request, cst_Content_Type);
      if(match && ! caml_string_notequal(match[1], "application/json")){
       var
        ppx_lwt_0 = caml_call1(Dream_pure_Message[19], request),
        _ac_ =
          function(body){
           var json = caml_call4(Yojson_Basic[33], 0, 0, 0, body);
           function _ag_(exn){throw caml_maybe_attach_backtrace(exn, 0);}
           function _ah_(param){
            if(0 !== param[0]){
             var
              json$0 = param[1],
              _am_ = caml_call5(Yojson_Basic[1], 0, 0, 0, 0, json$0);
             return caml_call4(Dream_server_Helpers[12], 0, 0, 0, _am_);
            }
            var match = param[1];
            if(-71406943 <= match[1]){
             var
              json = match[2],
              _aj_ = caml_call5(Yojson_Basic[1], 0, 0, 0, 0, json);
             return caml_call4(Dream_server_Helpers[12], 0, 0, 0, _aj_);
            }
            var
             _ak_ = make_error(cst_Subscriptions_and_streamin),
             _al_ = caml_call5(Yojson_Basic[1], 0, 0, 0, 0, _ak_);
            return caml_call4(Dream_server_Helpers[12], 0, 0, 0, _al_);
           }
           function _ai_(param){
            return run_query(make_context, schema, request, json);
           }
           return caml_call3(Lwt[9], _ai_, _ah_, _ag_);
          },
        _ad_ =
          function(exn){
           try{throw caml_maybe_attach_backtrace(exn, 0);}
           catch(exn){var exn$0 = caml_wrap_exception(exn); return exn$0;}
          };
       return caml_call3(Lwt[81], _ad_, ppx_lwt_0, _ac_);
      }
      var _aa_ = function(log){return caml_call2(log, [0, request], _G_);};
      caml_call1(log[2], _aa_);
      var
       _ab_ =
         caml_call5
          (Dream_pure_Message[6],
           _H_,
           0,
           0,
           Dream_pure_Stream[8],
           Dream_pure_Stream[7]);
      return caml_call1(Lwt[4], _ab_);
     }
    }
    function _ae_(log){
     return caml_call3
             (log,
              [0, request],
              _I_,
              caml_call1(Dream_pure_Method[1], method));
    }
    caml_call1(log[1], _ae_);
    var
     _af_ =
       caml_call5
        (Dream_pure_Message[6],
         _J_,
         0,
         0,
         Dream_pure_Stream[8],
         Dream_pure_Stream[7]);
    return caml_call1(Lwt[4], _af_);
   }
   function graphiql(opt, graphql_endpoint){
    if(opt)
     var sth = opt[1], default_query = sth;
    else
     var default_query = cst;
    if(caml_call2(Stdlib_String[37], graphql_endpoint, 34)){
     var
      _N_ = function(log){return caml_call3(log, 0, _K_, graphql_endpoint);};
     caml_call1(log[1], _N_);
     var _O_ = function(log){return caml_call2(log, 0, _L_);};
     caml_call1(log[1], _O_);
     var _P_ = function(log){return caml_call2(log, 0, _M_);};
     caml_call1(log[1], _P_);
    }
    var
     html =
       [246,
        function(param){
         var
          _S_ = Dream_graphiql[1],
          _T_ = caml_call1(Str[3], cst_ENDPOINT),
          _U_ = caml_call1(Str[1], _T_),
          _V_ = caml_call1(caml_call2(Str[16], _U_, graphql_endpoint), _S_),
          _W_ = caml_call1(Str[3], cst_DEFAULT_QUERY),
          _X_ = caml_call1(Str[1], _W_);
         return caml_call1(caml_call2(Str[16], _X_, default_query), _V_);
        }];
    return function(request){
     var _Q_ = runtime.caml_obj_tag(html);
     a:
     if(250 === _Q_)
      var _R_ = html[1];
     else{
      if(246 !== _Q_ && 244 !== _Q_){var _R_ = html; break a;}
      var _R_ = caml_call1(CamlinternalLazy[2], html);
     }
     return caml_call4(Dream_server_Helpers[11], 0, 0, 0, _R_);};
   }
   var
    Dream_graphql_Graphql =
      [0,
       log,
       make_error,
       run_query,
       operation_id,
       close_and_clean,
       ack_message,
       data_message,
       error_message,
       complete_message,
       handle_over_websocket,
       graphql,
       graphiql];
   runtime.caml_register_global
    (86, Dream_graphql_Graphql, "Dream__graphql__Graphql");
   return;
  }
  (globalThis));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLjAsImZpbGUiOiJkcmVhbV9fZ3JhcGhxbC5jbWEuanMiLCJzb3VyY2VSb290IjoiIiwibmFtZXMiOlsibG9nIiwibWFrZV9lcnJvciIsIm1lc3NhZ2UiLCJydW5fcXVlcnkiLCJtYWtlX2NvbnRleHQiLCJzY2hlbWEiLCJyZXF1ZXN0IiwianNvbiIsInF1ZXJ5Iiwib3BlcmF0aW9uX25hbWUiLCJ2YXJpYWJsZXMiLCJxdWVyeSQwIiwicXVlcnkkMSIsImpzb24kMCIsInZhcmlhYmxlcyQwIiwicHB4X2x3dF8wIiwiY29udGV4dCIsImV4biIsImV4biQwIiwib3BlcmF0aW9uX2lkIiwiY2xvc2VfYW5kX2NsZWFuIiwiY29kZSIsInN1YnNjcmlwdGlvbnMiLCJ3ZWJzb2NrZXQiLCJjbG9zZSIsImFja19tZXNzYWdlIiwiZGF0YV9tZXNzYWdlIiwiaWQiLCJwYXlsb2FkIiwiZXJyb3JfbWVzc2FnZSIsImNvbXBsZXRlX21lc3NhZ2UiLCJoYW5kbGVfb3Zlcl93ZWJzb2NrZXQiLCJsb29wIiwiaW5pdGVkIiwibWVzc2FnZV90eXBlIiwiaWQkMCIsInN1YnNjcmliZWQiLCJiYWNrdHJhY2UiLCJsaW5lIiwic3RyZWFtIiwicHB4X2x3dF8wJDAiLCJncmFwaHFsIiwibWV0aG9kIiwidXBncmFkZSIsInByb3RvY29sIiwiYm9keSIsImdyYXBoaXFsIiwib3B0IiwiZ3JhcGhxbF9lbmRwb2ludCIsInN0aCIsImRlZmF1bHRfcXVlcnkiLCJodG1sIl0sInNvdXJjZXMiOlsiL2hvbWUvbGlhbS1jYXJwZW50ZXIvLm9wYW0vcGVyc29uYWwtc2l0ZS9saWIvZHJlYW0vZ3JhcGhxbC9ncmFwaHFsLm1sIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0U7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Rzs7Ozs7Rzs7Ozs7Rzs7Ozs7Rzs7Ozs7Rzs7Ozs7R0EyQkU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBREVBLE1BQ0Y7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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LFdBQWVBLGFBSmdCZ0Qsa0JBS21DO0tBRGxFLFdBL1NBaEQ7S0ErU0EsbUJBRWVBLEtBQ2IsT0FBQSxXQURhQSxhQUNtRDtLQURsRSxXQWpUQUE7S0FpVEEsbUJBRWVBLEtBQ2IsT0FBQSxXQURhQSxhQUNnQztLQUQvQyxXQW5UQUE7O0lBd1RLO0tBREhtRDs7O1NBRytCOztVQUFBLE1BQUE7VUFBUixNQUFBO1VBRHZCLE1BQUEsV0FDUSx5QkFmcUJIO1VBZ0JFLE1BQUE7VUFBUixNQUFBO1NBRnZCLE9BQUEsV0FFUSx5QkFoQkNFOztJQW9CYixnQkFBSTVDO0tBQ0YsK0JBVEU2Qzs7O2dCQUFBQTs7K0NBQUFBO2dEQUFBQTs7S0FTVyxPQUFBLG1EQUFpQjtHQUFBOzs7O09BaFU5Qm5EO09BT0FDO09BU0FFO09BbUNBZ0I7T0FHQUM7T0FLQUs7T0FNQUM7T0FRQUc7T0FRQUM7T0FTQUM7T0E0SkFVO09BcURBSzs7OztFIiwic291cmNlc0NvbnRlbnQiOlsiKCogVGhpcyBmaWxlIGlzIHBhcnQgb2YgRHJlYW0sIHJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4gU2VlIExJQ0VOU0UubWRcbiAgIGZvciBkZXRhaWxzLCBvciB2aXNpdCBodHRwczovL2dpdGh1Yi5jb20vYWFudHJvbi9kcmVhbS5cblxuICAgQ29weXJpZ2h0IDIwMjEgQW50b24gQmFjaGluICopXG5cblxuXG5tb2R1bGUgSGVscGVycyA9IERyZWFtX19zZXJ2ZXIuSGVscGVyc1xubW9kdWxlIExvZyA9IERyZWFtX19zZXJ2ZXIuTG9nXG5tb2R1bGUgTWVzc2FnZSA9IERyZWFtX3B1cmUuTWVzc2FnZVxubW9kdWxlIE1ldGhvZCA9IERyZWFtX3B1cmUuTWV0aG9kXG5tb2R1bGUgU3RyZWFtID0gRHJlYW1fcHVyZS5TdHJlYW1cblxuXG5cbigqIFRoaXMgR3JhcGhRTCBoYW5kbGVyIHN1cHBvcnRzIHR3byB0cmFuc3BvcnRzLCBpLmUuIHR3byBHcmFwaFFMIFwid2lyZVwiXG4gICBwcm90b2NvbHM6XG5cbiAgIC0gSFRUUCByZXF1ZXN0cy9yZXNwb25zZXMgZm9yIHF1ZXJpZXMgYW5kIG11dGF0aW9ucy4gU2VlXG5cbiAgICAgICBodHRwczovL2dpdGh1Yi5jb20vZ3JhcGhxbC9ncmFwaHFsLW92ZXItaHR0cC9ibG9iL21haW4vc3BlYy9HcmFwaFFMT3ZlckhUVFAubWRcblxuICAgLSBXZWJTb2NrZXRzIGZvciBxdWVyaWVzLCBtdXRhdGlvbnMsIGFuZCBzdWJzY3JpcHRpb25zLiBTZWVcblxuICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9lbmlzZGVuam8vZ3JhcGhxbC13cy9ibG9iL21hc3Rlci9QUk9UT0NPTC5tZCAqKVxuXG5sZXQgbG9nID1cbiAgTG9nLnN1Yl9sb2cgXCJkcmVhbS5ncmFwaHFsXCJcblxuXG5cbigqIFNoYXJlZCBiZXR3ZWVuIEhUVFAgYW5kIFdlYlNvY2tldCB0cmFuc3BvcnQuICopXG5cbmxldCBtYWtlX2Vycm9yIG1lc3NhZ2UgPVxuICBgQXNzb2MgW1xuICAgIFwiZXJyb3JzXCIsIGBMaXN0IFtcbiAgICAgIGBBc3NvYyBbXG4gICAgICAgIFwibWVzc2FnZVwiLCBgU3RyaW5nIG1lc3NhZ2VcbiAgICAgIF1cbiAgICBdXG4gIF1cblxubGV0IHJ1bl9xdWVyeSBtYWtlX2NvbnRleHQgc2NoZW1hIHJlcXVlc3QganNvbiA9XG4gIGxldCBtb2R1bGUgWSA9IFlvanNvbi5CYXNpYy5VdGlsIGluXG5cbiAgbGV0IHF1ZXJ5ID0gICAgICAgICAganNvbiB8PiBZLm1lbWJlciBcInF1ZXJ5XCIgfD4gWS50b19zdHJpbmdfb3B0aW9uXG4gIGFuZCBvcGVyYXRpb25fbmFtZSA9IGpzb24gfD4gWS5tZW1iZXIgXCJvcGVyYXRpb25OYW1lXCIgfD4gWS50b19zdHJpbmdfb3B0aW9uXG4gIGFuZCB2YXJpYWJsZXMgPSAgICAgIGpzb24gfD4gWS5tZW1iZXIgXCJ2YXJpYWJsZXNcIiB8PiBPcHRpb24uc29tZSBpblxuXG4gIG1hdGNoIHF1ZXJ5IHdpdGhcbiAgfCBOb25lIC0+IEx3dC5yZXR1cm4gKEVycm9yIChtYWtlX2Vycm9yIFwiTm8gcXVlcnlcIikpXG4gIHwgU29tZSBxdWVyeSAtPlxuXG4gIG1hdGNoIEdyYXBocWxfcGFyc2VyLnBhcnNlIHF1ZXJ5IHdpdGhcbiAgfCBFcnJvciBtZXNzYWdlIC0+IEx3dC5yZXR1cm4gKEVycm9yIChtYWtlX2Vycm9yIG1lc3NhZ2UpKVxuICB8IE9rIHF1ZXJ5IC0+XG5cbiAgKCogVE9ETyBDb25zaWRlciBiZWluZyBtb3JlIHN0cmljdCBoZXJlLCBhbGxvd2luZyBvbmx5IGBBc3NvYyBhbmQgYE51bGwuICopXG4gIGxldCB2YXJpYWJsZXMgPVxuICAgIG1hdGNoIHZhcmlhYmxlcyB3aXRoXG4gICAgfCBTb21lIChgQXNzb2MgXyBhcyBqc29uKSAtPlxuICAgICAgKFlvanNvbi5CYXNpYy5VdGlsLnRvX2Fzc29jIGpzb24gOj5cbiAgICAgICAgKHN0cmluZyAqIEdyYXBocWxfcGFyc2VyLmNvbnN0X3ZhbHVlKSBsaXN0KVxuICAgICAgfD4gT3B0aW9uLnNvbWVcbiAgICB8IF8gLT5cbiAgICAgIE5vbmVcbiAgaW5cblxuICBsZXQlbHd0IGNvbnRleHQgPSBtYWtlX2NvbnRleHQgcmVxdWVzdCBpblxuXG4gIEdyYXBocWxfbHd0LlNjaGVtYS5leGVjdXRlXG4gICAgP3ZhcmlhYmxlcyA/b3BlcmF0aW9uX25hbWUgc2NoZW1hIGNvbnRleHQgcXVlcnlcblxuXG5cbigqIFdlYlNvY2tldCB0cmFuc3BvcnQuICopXG5cbmxldCBvcGVyYXRpb25faWQganNvbiA9XG4gIFlvanNvbi5CYXNpYy5VdGlsLihqc29uIHw+IG1lbWJlciBcImlkXCIgfD4gdG9fc3RyaW5nX29wdGlvbilcblxubGV0IGNsb3NlX2FuZF9jbGVhbiA/Y29kZSBzdWJzY3JpcHRpb25zIHdlYnNvY2tldCA9XG4gIGxldCVsd3QgKCkgPSBNZXNzYWdlLmNsb3NlX3dlYnNvY2tldCA/Y29kZSB3ZWJzb2NrZXQgaW5cbiAgSGFzaHRibC5pdGVyIChmdW4gXyBjbG9zZSAtPiBjbG9zZSAoKSkgc3Vic2NyaXB0aW9ucztcbiAgTHd0LnJldHVybl91bml0XG5cbmxldCBhY2tfbWVzc2FnZSA9XG4gIGBBc3NvYyBbXG4gICAgXCJ0eXBlXCIsIGBTdHJpbmcgXCJjb25uZWN0aW9uX2Fja1wiO1xuICBdXG4gIHw+IFlvanNvbi5CYXNpYy50b19zdHJpbmdcblxubGV0IGRhdGFfbWVzc2FnZSBpZCBwYXlsb2FkID1cbiAgYEFzc29jIFtcbiAgICBcInR5cGVcIiwgYFN0cmluZyBcIm5leHRcIjtcbiAgICBcImlkXCIsIGBTdHJpbmcgaWQ7XG4gICAgXCJwYXlsb2FkXCIsIHBheWxvYWQ7XG4gIF1cbiAgfD4gWW9qc29uLkJhc2ljLnRvX3N0cmluZ1xuXG5sZXQgZXJyb3JfbWVzc2FnZSBpZCBqc29uID1cbiAgYEFzc29jIFtcbiAgICBcInR5cGVcIiwgYFN0cmluZyBcImVycm9yXCI7XG4gICAgXCJpZFwiLCBgU3RyaW5nIGlkO1xuICAgIFwicGF5bG9hZFwiLCBqc29uIHw+IFlvanNvbi5CYXNpYy5VdGlsLm1lbWJlciBcImVycm9yc1wiO1xuICBdXG4gIHw+IFlvanNvbi5CYXNpYy50b19zdHJpbmdcblxubGV0IGNvbXBsZXRlX21lc3NhZ2UgaWQgPVxuICBgQXNzb2MgW1xuICAgIFwidHlwZVwiLCBgU3RyaW5nIFwiY29tcGxldGVcIjtcbiAgICBcImlkXCIsIGBTdHJpbmcgaWQ7XG4gIF1cbiAgfD4gWW9qc29uLkJhc2ljLnRvX3N0cmluZ1xuXG4oKiBUT0RPIFRha2UgY2FyZSB0byBwYXNzIGFyb3VuZCB0aGUgcmVxdWVzdCBMd3Qua2V5IGluIGFzeW5jLCBldGMuICopXG4oKiBUT0RPIFRlc3QgY2xpZW50IGNvbXBsZXRlIHJhY2luZyBhZ2FpbnN0IGEgc3RyZWFtLiAqKVxubGV0IGhhbmRsZV9vdmVyX3dlYnNvY2tldCBtYWtlX2NvbnRleHQgc2NoZW1hIHN1YnNjcmlwdGlvbnMgcmVxdWVzdCB3ZWJzb2NrZXQgPVxuICBsZXQgcmVjIGxvb3AgaW5pdGVkID1cbiAgICBtYXRjaCVsd3QgSGVscGVycy5yZWNlaXZlIHdlYnNvY2tldCB3aXRoXG4gICAgfCBOb25lIC0+XG4gICAgICBsb2cuaW5mbyAoZnVuIGxvZyAtPiBsb2cgfnJlcXVlc3QgXCJHcmFwaFFMIFdlYlNvY2tldCBjbG9zZWQgYnkgY2xpZW50XCIpO1xuICAgICAgY2xvc2VfYW5kX2NsZWFuIHN1YnNjcmlwdGlvbnMgd2Vic29ja2V0XG4gICAgfCBTb21lIG1lc3NhZ2UgLT5cblxuICAgIGxvZy5kZWJ1ZyAoZnVuIGxvZyAtPiBsb2cgfnJlcXVlc3QgXCJNZXNzYWdlICclcydcIiBtZXNzYWdlKTtcblxuICAgICgqIFRPRE8gQXZvaWQgdXNpbmcgZXhjZXB0aW9ucyBoZXJlLiAqKVxuICAgIG1hdGNoIFlvanNvbi5CYXNpYy5mcm9tX3N0cmluZyBtZXNzYWdlIHdpdGhcbiAgICB8IGV4Y2VwdGlvbiBfIC0+XG4gICAgICBsb2cud2FybmluZyAoZnVuIGxvZyAtPiBsb2cgfnJlcXVlc3QgXCJHcmFwaFFMIG1lc3NhZ2UgaXMgbm90IEpTT05cIik7XG4gICAgICBjbG9zZV9hbmRfY2xlYW4gc3Vic2NyaXB0aW9ucyB3ZWJzb2NrZXQgfmNvZGU6NDQwMFxuICAgIHwganNvbiAtPlxuXG4gICAgbWF0Y2ggWW9qc29uLkJhc2ljLlV0aWwuKGpzb24gfD4gbWVtYmVyIFwidHlwZVwiIHw+IHRvX3N0cmluZ19vcHRpb24pIHdpdGhcbiAgICB8IE5vbmUgLT5cbiAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+IGxvZyB+cmVxdWVzdCBcIkdyYXBoUUwgbWVzc2FnZSBsYWNrcyBhIHR5cGVcIik7XG4gICAgICBjbG9zZV9hbmRfY2xlYW4gc3Vic2NyaXB0aW9ucyB3ZWJzb2NrZXQgfmNvZGU6NDQwMFxuICAgIHwgU29tZSBtZXNzYWdlX3R5cGUgLT5cblxuICAgIG1hdGNoIG1lc3NhZ2VfdHlwZSB3aXRoXG5cbiAgICB8IFwiY29ubmVjdGlvbl9pbml0XCIgLT5cbiAgICAgIGlmIGluaXRlZCB0aGVuIGJlZ2luXG4gICAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+IGxvZyB+cmVxdWVzdCBcIkR1cGxpY2F0ZSBjb25uZWN0aW9uX2luaXRcIik7XG4gICAgICAgIGNsb3NlX2FuZF9jbGVhbiBzdWJzY3JpcHRpb25zIHdlYnNvY2tldCB+Y29kZTo0NDI5XG4gICAgICBlbmRcbiAgICAgIGVsc2UgYmVnaW5cbiAgICAgICAgbGV0JWx3dCAoKSA9IEhlbHBlcnMuc2VuZCB3ZWJzb2NrZXQgYWNrX21lc3NhZ2UgaW5cbiAgICAgICAgbG9vcCB0cnVlXG4gICAgICBlbmRcblxuICAgIHwgXCJjb21wbGV0ZVwiIC0+XG4gICAgICBpZiBub3QgaW5pdGVkIHRoZW4gYmVnaW5cbiAgICAgICAgbG9nLndhcm5pbmcgKGZ1biBsb2cgLT4gbG9nIH5yZXF1ZXN0IFwiY29tcGxldGUgYmVmb3JlIGNvbm5lY3Rpb25faW5pdFwiKTtcbiAgICAgICAgY2xvc2VfYW5kX2NsZWFuIHN1YnNjcmlwdGlvbnMgd2Vic29ja2V0IH5jb2RlOjQ0MDFcbiAgICAgIGVuZFxuICAgICAgZWxzZSBiZWdpblxuICAgICAgICBtYXRjaCBvcGVyYXRpb25faWQganNvbiB3aXRoXG4gICAgICAgIHwgTm9uZSAtPlxuICAgICAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+XG4gICAgICAgICAgICBsb2cgfnJlcXVlc3QgXCJjbGllbnQgY29tcGxldGU6IG9wZXJhdGlvbiBpZCBtaXNzaW5nXCIpO1xuICAgICAgICAgIGNsb3NlX2FuZF9jbGVhbiBzdWJzY3JpcHRpb25zIHdlYnNvY2tldCB+Y29kZTo0NDAwXG4gICAgICAgIHwgU29tZSBpZCAtPlxuICAgICAgICAgIGJlZ2luIG1hdGNoIEhhc2h0YmwuZmluZF9vcHQgc3Vic2NyaXB0aW9ucyBpZCB3aXRoXG4gICAgICAgICAgfCBOb25lIC0+ICgpXG4gICAgICAgICAgfCBTb21lIGNsb3NlIC0+IGNsb3NlICgpXG4gICAgICAgICAgZW5kO1xuICAgICAgICAgIGxvb3AgaW5pdGVkXG4gICAgICBlbmRcblxuICAgIHwgXCJzdWJzY3JpYmVcIiAtPlxuICAgICAgaWYgbm90IGluaXRlZCB0aGVuIGJlZ2luXG4gICAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+XG4gICAgICAgICAgbG9nIH5yZXF1ZXN0IFwic3Vic2NyaWJlIGJlZm9yZSBjb25uZWN0aW9uX2luaXRcIik7XG4gICAgICAgIGNsb3NlX2FuZF9jbGVhbiBzdWJzY3JpcHRpb25zIHdlYnNvY2tldCB+Y29kZTo0NDAxXG4gICAgICBlbmRcbiAgICAgIGVsc2UgYmVnaW5cbiAgICAgICAgbWF0Y2ggb3BlcmF0aW9uX2lkIGpzb24gd2l0aFxuICAgICAgICB8IE5vbmUgLT5cbiAgICAgICAgICBsb2cud2FybmluZyAoZnVuIGxvZyAtPlxuICAgICAgICAgICAgbG9nIH5yZXF1ZXN0IFwic3Vic2NyaWJlOiBvcGVyYXRpb24gaWQgbWlzc2luZ1wiKTtcbiAgICAgICAgICBjbG9zZV9hbmRfY2xlYW4gc3Vic2NyaXB0aW9ucyB3ZWJzb2NrZXQgfmNvZGU6NDQwMFxuICAgICAgICB8IFNvbWUgaWQgLT5cblxuICAgICAgICBsZXQgcGF5bG9hZCA9IGpzb24gfD4gWW9qc29uLkJhc2ljLlV0aWwubWVtYmVyIFwicGF5bG9hZFwiIGluXG5cbiAgICAgICAgTHd0LmFzeW5jIGJlZ2luIGZ1biAoKSAtPlxuICAgICAgICAgIGxldCBzdWJzY3JpYmVkID0gcmVmIGZhbHNlIGluXG5cbiAgICAgICAgICB0cnklbHd0XG4gICAgICAgICAgICBtYXRjaCVsd3QgcnVuX3F1ZXJ5IG1ha2VfY29udGV4dCBzY2hlbWEgcmVxdWVzdCBwYXlsb2FkIHdpdGhcbiAgICAgICAgICAgIHwgRXJyb3IganNvbiAtPlxuICAgICAgICAgICAgICBsb2cud2FybmluZyAoZnVuIGxvZyAtPlxuICAgICAgICAgICAgICAgIGxvZyB+cmVxdWVzdFxuICAgICAgICAgICAgICAgICAgXCJzdWJzY3JpYmU6IGVycm9yICVzXCIgKFlvanNvbi5CYXNpYy50b19zdHJpbmcganNvbikpO1xuICAgICAgICAgICAgICBIZWxwZXJzLnNlbmQgd2Vic29ja2V0IChlcnJvcl9tZXNzYWdlIGlkIGpzb24pXG5cbiAgICAgICAgICAgICgqIEl0J3Mgbm90IGNsZWFyIHRoYXQgdGhpcyBjYXNlIGV2ZXIgb2NjdXJzLCBiZWNhdXNlIGdyYXBocWwtd3MgaXNcbiAgICAgICAgICAgICAgIG9ubHkgdXNlZCBmb3Igc3Vic2NyaXB0aW9ucywgYXQgdGhlIHByb3RvY29sIGxldmVsLiAqKVxuICAgICAgICAgICAgfCBPayAoYFJlc3BvbnNlIGpzb24pIC0+XG4gICAgICAgICAgICAgIGxldCVsd3QgKCkgPSBIZWxwZXJzLnNlbmQgd2Vic29ja2V0IChkYXRhX21lc3NhZ2UgaWQganNvbikgaW5cbiAgICAgICAgICAgICAgbGV0JWx3dCAoKSA9IEhlbHBlcnMuc2VuZCB3ZWJzb2NrZXQgKGNvbXBsZXRlX21lc3NhZ2UgaWQpIGluXG4gICAgICAgICAgICAgIEx3dC5yZXR1cm5fdW5pdFxuXG4gICAgICAgICAgICB8IE9rIChgU3RyZWFtIChzdHJlYW0sIGNsb3NlKSkgLT5cbiAgICAgICAgICAgICAgbWF0Y2ggSGFzaHRibC5tZW0gc3Vic2NyaXB0aW9ucyBpZCB3aXRoXG4gICAgICAgICAgICAgIHwgdHJ1ZSAtPlxuICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+XG4gICAgICAgICAgICAgICAgICBsb2cgfnJlcXVlc3QgXCJzdWJzY3JpYmU6IGR1cGxpY2F0ZSBvcGVyYXRpb24gaWRcIik7XG4gICAgICAgICAgICAgICAgY2xvc2VfYW5kX2NsZWFuIHN1YnNjcmlwdGlvbnMgd2Vic29ja2V0IH5jb2RlOjQ0MDlcbiAgICAgICAgICAgICAgfCBmYWxzZSAtPlxuXG4gICAgICAgICAgICAgIEhhc2h0YmwucmVwbGFjZSBzdWJzY3JpcHRpb25zIGlkIGNsb3NlO1xuICAgICAgICAgICAgICBzdWJzY3JpYmVkIDo9IHRydWU7XG5cbiAgICAgICAgICAgICAgbGV0JWx3dCAoKSA9XG4gICAgICAgICAgICAgICAgc3RyZWFtIHw+IEx3dF9zdHJlYW0uaXRlcl9zIChmdW5jdGlvblxuICAgICAgICAgICAgICAgICAgfCBPayBqc29uIC0+XG4gICAgICAgICAgICAgICAgICAgIEhlbHBlcnMuc2VuZCB3ZWJzb2NrZXQgKGRhdGFfbWVzc2FnZSBpZCBqc29uKVxuICAgICAgICAgICAgICAgICAgfCBFcnJvciBqc29uIC0+XG4gICAgICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+XG4gICAgICAgICAgICAgICAgICAgICAgbG9nIH5yZXF1ZXN0XG4gICAgICAgICAgICAgICAgICAgICAgICBcIlN1YnNjcmlwdGlvbjogZXJyb3IgJXNcIiAoWW9qc29uLkJhc2ljLnRvX3N0cmluZyBqc29uKSk7XG4gICAgICAgICAgICAgICAgICAgIEhlbHBlcnMuc2VuZCB3ZWJzb2NrZXQgKGVycm9yX21lc3NhZ2UgaWQganNvbikpXG4gICAgICAgICAgICAgIGluXG5cbiAgICAgICAgICAgICAgbGV0JWx3dCAoKSA9IEhlbHBlcnMuc2VuZCB3ZWJzb2NrZXQgKGNvbXBsZXRlX21lc3NhZ2UgaWQpIGluXG4gICAgICAgICAgICAgIEhhc2h0YmwucmVtb3ZlIHN1YnNjcmlwdGlvbnMgaWQ7XG4gICAgICAgICAgICAgIEx3dC5yZXR1cm5fdW5pdFxuXG4gICAgICAgICAgd2l0aCBleG4gLT5cbiAgICAgICAgICAgIGxldCBiYWNrdHJhY2UgPSBQcmludGV4Yy5nZXRfYmFja3RyYWNlICgpIGluXG4gICAgICAgICAgICBsb2cuZXJyb3IgKGZ1biBsb2cgLT5cbiAgICAgICAgICAgICAgbG9nIH5yZXF1ZXN0IFwiRXhjZXB0aW9uIHdoaWxlIGhhbmRsaW5nIFdlYlNvY2tldCBtZXNzYWdlOlwiKTtcbiAgICAgICAgICAgIGxvZy5lcnJvciAoZnVuIGxvZyAtPlxuICAgICAgICAgICAgICBsb2cgfnJlcXVlc3QgXCIlc1wiIChQcmludGV4Yy50b19zdHJpbmcgZXhuKSk7XG4gICAgICAgICAgICBiYWNrdHJhY2VcbiAgICAgICAgICAgIHw+IExvZy5pdGVyX2JhY2t0cmFjZSAoZnVuIGxpbmUgLT5cbiAgICAgICAgICAgICAgbG9nLmVycm9yIChmdW4gbG9nIC0+IGxvZyB+cmVxdWVzdCBcIiVzXCIgbGluZSkpO1xuXG4gICAgICAgICAgICB0cnklbHd0XG4gICAgICAgICAgICAgIGxldCVsd3QgKCkgPVxuICAgICAgICAgICAgICAgIEhlbHBlcnMuc2VuZFxuICAgICAgICAgICAgICAgICAgd2Vic29ja2V0XG4gICAgICAgICAgICAgICAgICAoZXJyb3JfbWVzc2FnZSBpZCAobWFrZV9lcnJvciBcIkludGVybmFsIFNlcnZlciBFcnJvclwiKSlcbiAgICAgICAgICAgICAgaW5cbiAgICAgICAgICAgICAgaWYgIXN1YnNjcmliZWQgdGhlblxuICAgICAgICAgICAgICAgIEhlbHBlcnMuc2VuZCB3ZWJzb2NrZXQgKGNvbXBsZXRlX21lc3NhZ2UgaWQpXG4gICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBMd3QucmV0dXJuX3VuaXRcbiAgICAgICAgICAgIHdpdGggXyAtPlxuICAgICAgICAgICAgICBMd3QucmV0dXJuX3VuaXRcbiAgICAgICAgICBlbmQ7XG5cbiAgICAgICAgbG9vcCBpbml0ZWRcbiAgICAgIGVuZFxuXG4gICAgfCBtZXNzYWdlX3R5cGUgLT5cbiAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+XG4gICAgICAgIGxvZyB+cmVxdWVzdCBcIlVua25vd24gV2ViU29ja2V0IG1lc3NhZ2UgdHlwZSAnJXMnXCIgbWVzc2FnZV90eXBlKTtcbiAgICAgIGNsb3NlX2FuZF9jbGVhbiBzdWJzY3JpcHRpb25zIHdlYnNvY2tldCB+Y29kZTo0NDAwXG4gIGluXG5cbiAgbG9vcCBmYWxzZVxuXG5cblxuKCogSFRUUCB0cmFuc3BvcnQuXG5cbiAgIFN1cHBvcnRzIGVpdGhlciBQT1NUIHJlcXVlc3RzIGNhcnJ5aW5nIGEgR3JhcGhRTCBxdWVyeSwgb3IgR0VUIHJlcXVlc3RzXG4gICBjYXJyeWluZyBXZWJTb2NrZXQgdXBncmFkZSBoZWFkZXJzLiAqKVxuXG5sZXQgZ3JhcGhxbCBtYWtlX2NvbnRleHQgc2NoZW1hID0gZnVuIHJlcXVlc3QgLT5cbiAgbWF0Y2ggTWVzc2FnZS5tZXRob2RfIHJlcXVlc3Qgd2l0aFxuICB8IGBHRVQgLT5cbiAgICBsZXQgdXBncmFkZSA9IE1lc3NhZ2UuaGVhZGVyIHJlcXVlc3QgXCJVcGdyYWRlXCJcbiAgICBhbmQgcHJvdG9jb2wgPSBNZXNzYWdlLmhlYWRlciByZXF1ZXN0IFwiU2VjLVdlYlNvY2tldC1Qcm90b2NvbFwiIGluXG4gICAgYmVnaW4gbWF0Y2ggdXBncmFkZSwgcHJvdG9jb2wgd2l0aFxuICAgIHwgU29tZSBcIndlYnNvY2tldFwiLCBTb21lIFwiZ3JhcGhxbC10cmFuc3BvcnQtd3NcIiAtPlxuICAgICAgSGVscGVycy53ZWJzb2NrZXRcbiAgICAgICAgfmhlYWRlcnM6W1wiU2VjLVdlYlNvY2tldC1Qcm90b2NvbFwiLCBcImdyYXBocWwtdHJhbnNwb3J0LXdzXCJdXG4gICAgICAgIChoYW5kbGVfb3Zlcl93ZWJzb2NrZXQgbWFrZV9jb250ZXh0IHNjaGVtYSAoSGFzaHRibC5jcmVhdGUgMTYpIHJlcXVlc3QpXG4gICAgfCBfIC0+XG4gICAgICBsb2cud2FybmluZyAoZnVuIGxvZyAtPiBsb2cgfnJlcXVlc3QgXCJVcGdyYWRlOiB3ZWJzb2NrZXQgaGVhZGVyIG1pc3NpbmdcIik7XG4gICAgICBNZXNzYWdlLnJlc3BvbnNlIH5zdGF0dXM6YE5vdF9Gb3VuZCBTdHJlYW0uZW1wdHkgU3RyZWFtLm51bGxcbiAgICAgIHw+IEx3dC5yZXR1cm5cbiAgICBlbmRcblxuICB8IGBQT1NUIC0+XG4gICAgYmVnaW4gbWF0Y2ggTWVzc2FnZS5oZWFkZXIgcmVxdWVzdCBcIkNvbnRlbnQtVHlwZVwiIHdpdGhcbiAgICB8IFNvbWUgXCJhcHBsaWNhdGlvbi9qc29uXCIgLT5cbiAgICAgIGxldCVsd3QgYm9keSA9IE1lc3NhZ2UuYm9keSByZXF1ZXN0IGluXG4gICAgICAoKiBUT0RPIFRoaXMgYWxtb3N0IGNlcnRhaW5seSByYWlzZXMgZXhjZXB0aW9ucy4uLiAqKVxuICAgICAgbGV0IGpzb24gPSBZb2pzb24uQmFzaWMuZnJvbV9zdHJpbmcgYm9keSBpblxuXG4gICAgICBiZWdpbiBtYXRjaCVsd3QgcnVuX3F1ZXJ5IG1ha2VfY29udGV4dCBzY2hlbWEgcmVxdWVzdCBqc29uIHdpdGhcbiAgICAgIHwgRXJyb3IganNvbiAtPlxuICAgICAgICBZb2pzb24uQmFzaWMudG9fc3RyaW5nIGpzb25cbiAgICAgICAgfD4gSGVscGVycy5qc29uXG5cbiAgICAgIHwgT2sgKGBSZXNwb25zZSBqc29uKSAtPlxuICAgICAgICBZb2pzb24uQmFzaWMudG9fc3RyaW5nIGpzb25cbiAgICAgICAgfD4gSGVscGVycy5qc29uXG5cbiAgICAgIHwgT2sgKGBTdHJlYW0gXykgLT5cbiAgICAgICAgbWFrZV9lcnJvciBcIlN1YnNjcmlwdGlvbnMgYW5kIHN0cmVhbWluZyBzaG91bGQgdXNlIFdlYlNvY2tldCB0cmFuc3BvcnRcIlxuICAgICAgICB8PiBZb2pzb24uQmFzaWMudG9fc3RyaW5nXG4gICAgICAgIHw+IEhlbHBlcnMuanNvblxuICAgICAgZW5kXG5cbiAgICB8IF8gLT5cbiAgICAgIGxvZy53YXJuaW5nIChmdW4gbG9nIC0+IGxvZyB+cmVxdWVzdFxuICAgICAgICBcIkNvbnRlbnQtVHlwZSBub3QgJ2FwcGxpY2F0aW9uL2pzb24nXCIpO1xuICAgICAgTWVzc2FnZS5yZXNwb25zZSB+c3RhdHVzOmBCYWRfUmVxdWVzdCBTdHJlYW0uZW1wdHkgU3RyZWFtLm51bGxcbiAgICAgIHw+IEx3dC5yZXR1cm5cbiAgICBlbmRcblxuICB8IG1ldGhvZF8gLT5cbiAgICBsb2cuZXJyb3IgKGZ1biBsb2cgLT4gbG9nIH5yZXF1ZXN0XG4gICAgICBcIk1ldGhvZCAlczsgbXVzdCBiZSBHRVQgb3IgUE9TVFwiIChNZXRob2QubWV0aG9kX3RvX3N0cmluZyBtZXRob2RfKSk7XG4gICAgTWVzc2FnZS5yZXNwb25zZSB+c3RhdHVzOmBOb3RfRm91bmQgU3RyZWFtLmVtcHR5IFN0cmVhbS5udWxsXG4gICAgfD4gTHd0LnJldHVyblxuXG5cblxubGV0IGdyYXBoaXFsID8oZGVmYXVsdF9xdWVyeSA9IFwiXCIpIGdyYXBocWxfZW5kcG9pbnQgPVxuICBiZWdpbiBtYXRjaCBTdHJpbmcuaW5kZXhfb3B0IGdyYXBocWxfZW5kcG9pbnQgJ1wiJyB3aXRoXG4gIHwgTm9uZSAtPiAoKVxuICB8IFNvbWUgXyAtPlxuICAgIGxvZy5lcnJvciAoZnVuIGxvZyAtPlxuICAgICAgbG9nIFwiR3JhcGhRTCBlbmRwb2ludCByb3V0ZSAnJXMnIGNvbnRhaW5zICdcXFwiJ1wiIGdyYXBocWxfZW5kcG9pbnQpO1xuICAgIGxvZy5lcnJvciAoZnVuIGxvZyAtPlxuICAgICAgbG9nIFwiSWYgaW50ZW50aW9uYWwsIHBsZWFzZSBvcGVuIGFuIGlzc3VlIGFib3V0IHN1cHBvcnRpbmcgdGhpc1wiKTtcbiAgICBsb2cuZXJyb3IgKGZ1biBsb2cgLT5cbiAgICAgIGxvZyBcImh0dHBzOi8vZ2l0aHViLmNvbS9hYW50cm9uL2RyZWFtL2lzc3Vlc1wiKVxuICBlbmQ7XG5cbiAgbGV0IGh0bWwgPVxuICAgIGxhenkgYmVnaW5cbiAgICAgIERyZWFtX19ncmFwaGlxbC5jb250ZW50XG4gICAgICB8PiBTdHIuKGdsb2JhbF9yZXBsYWNlIChyZWdleHAgKHF1b3RlIFwiJSVFTkRQT0lOVCUlXCIpKSBncmFwaHFsX2VuZHBvaW50KVxuICAgICAgfD4gU3RyLihnbG9iYWxfcmVwbGFjZSAocmVnZXhwIChxdW90ZSBcIiUlREVGQVVMVF9RVUVSWSUlXCIpKSBkZWZhdWx0X3F1ZXJ5KVxuICAgIGVuZFxuICBpblxuXG4gIGZ1biBfcmVxdWVzdCAtPlxuICAgIEhlbHBlcnMuaHRtbCAoTGF6eS5mb3JjZSBodG1sKVxuIl19
