// Generated by js_of_ocaml
//# buildInfo:effects=false, kind=cma, use-js-string=true, version=5.6.0

//# unitInfo: Provides: Vdom_file_download
//# unitInfo: Requires: Core, Core__Bigstring, Core__List, Css_gen, Js_of_ocaml__Dom_html, Js_of_ocaml__File, Js_of_ocaml__Js, Js_of_ocaml__Typed_array, Ppx_bench_lib__Benchmark_accumulator, Ppx_expect_runtime, Ppx_inline_test_lib, Ppx_module_timer_runtime, Sexplib0__Sexp_conv, Virtual_dom__Effect, Virtual_dom__Node, Virtual_dom__Vdom
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Vdom_file_download$0 = "Vdom_file_download",
    cst_vdom_file_download$0 = "vdom_file_download";
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   function caml_call3(f, a0, a1, a2){
    return (f.l >= 0 ? f.l : f.l = f.length) == 3
            ? f(a0, a1, a2)
            : runtime.caml_call_gen(f, [a0, a1, a2]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    Virtual_dom_Effect = global_data.Virtual_dom__Effect,
    Css_gen = global_data.Css_gen,
    Virtual_dom_Vdom = global_data.Virtual_dom__Vdom,
    Core_List = global_data.Core__List,
    Virtual_dom_Node = global_data.Virtual_dom__Node,
    Sexplib0_Sexp_conv = global_data.Sexplib0__Sexp_conv,
    Core = global_data.Core,
    Ppx_inline_test_lib = global_data.Ppx_inline_test_lib,
    Js_of_ocaml_Dom_html = global_data.Js_of_ocaml__Dom_html,
    Core_Bigstring = global_data.Core__Bigstring,
    Js_of_ocaml_Typed_array = global_data.Js_of_ocaml__Typed_array,
    Js_of_ocaml_File = global_data.Js_of_ocaml__File,
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Ppx_expect_runtime = global_data.Ppx_expect_runtime;
   caml_call1(Ppx_module_timer_runtime[4], cst_Vdom_file_download$0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][1], cst_vdom_file_download$0);
   caml_call1
    (Ppx_expect_runtime[1][1], "vdom_file_download/vdom_file_download.ml");
   caml_call2
    (Ppx_inline_test_lib[6],
     cst_vdom_file_download$0,
     "vdom_file_download.ml");
   var
    _d_ = [0, 869834347, "grey"],
    _b_ = [0, "mimetype"],
    _c_ = [0, "filename"],
    cst_Download_triggered = "Download triggered",
    _a_ = [0, [11, "<downloader: ", [2, 0, [12, 62, 0]]], "<downloader: %s>"],
    cst_vdom_file_download = cst_vdom_file_download$0,
    cst_Vdom_file_download = cst_Vdom_file_download$0;
   function create(filename, mimetype, contents){return [0, filename, mimetype, contents];
   }
   function sexp_of_t(t){return [0, caml_call2(Core[265], _a_, t[1])];}
   function trigger(param){
    var contents = param[3], mimetype = param[2], filename = param[1];
    if(Ppx_inline_test_lib[1]){
     var
      _l_ = [0, caml_call1(Sexplib0_Sexp_conv[7], contents), 0],
      _m_ = [0, [1, [0, _b_, [0, caml_call1(Core[558], mimetype), 0]]], _l_],
      _n_ = [0, [1, [0, _c_, [0, caml_call1(Core[558], filename), 0]]], _m_],
      _o_ =
        [1,
         [0, caml_call1(Sexplib0_Sexp_conv[7], cst_Download_triggered), _n_]];
     return caml_call2(Core[256], 0, _o_);
    }
    var
     a = caml_call1(Js_of_ocaml_Dom_html[66], Js_of_ocaml_Dom_html[2]),
     _p_ = caml_call3(Core_Bigstring[14], 0, 0, contents),
     contents_bigstr = caml_call1(Js_of_ocaml_Typed_array[50][1], _p_),
     blob =
       caml_call3
        (Js_of_ocaml_File[2],
         [0, mimetype],
         0,
         [0, [0, 1037850489, contents_bigstr], 0]),
     t0 = Js_of_ocaml_Dom_html[8],
     url = t0.URL.createObjectURL(blob);
    a.setAttribute("href", url);
    a.setAttribute("download", runtime.caml_jsstring_of_string(filename));
    a.click();
    var t10 = Js_of_ocaml_Dom_html[8];
    return t10.URL.revokeObjectURL(url);
   }
   function create$0(opt, _f_, _e_, get_download, button_text, param){
    if(opt) var sth = opt[1], enabled = sth; else var enabled = 1;
    if(_f_)
     var sth$0 = _f_[1], on_click = sth$0;
    else
     var on_click = function(param){return Virtual_dom_Effect[1];};
    if(_e_) var sth$1 = _e_[1], extra_attrs = sth$1; else var extra_attrs = 0;
    function trigger_csv_download(ev){
     trigger(caml_call1(get_download, 0));
     return caml_call1(on_click, ev);
    }
    if(enabled)
     var enabled_disabled = 0;
    else
     var
      _j_ = caml_call1(Css_gen[51], _d_),
      _k_ = [0, caml_call1(Virtual_dom_Vdom[1][32], _j_), 0],
      enabled_disabled = [0, Virtual_dom_Vdom[1][19], _k_];
    var
     _g_ =
       [0,
        extra_attrs,
        [0,
         enabled_disabled,
         [0,
          [0, caml_call1(Virtual_dom_Vdom[1][61], trigger_csv_download), 0],
          0]]],
     attrs = caml_call1(Core_List[11], _g_),
     _h_ = [0, caml_call1(Virtual_dom_Node[6], button_text), 0],
     _i_ = [0, [0, caml_call1(Virtual_dom_Vdom[1][10], attrs), 0]];
    return caml_call3(Virtual_dom_Node[12], 0, _i_, _h_);
   }
   var Button = [0, create$0];
   caml_call1(Ppx_inline_test_lib[7], cst_vdom_file_download);
   caml_call1(Ppx_expect_runtime[1][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Vdom_file_download);
   var Vdom_file_download = [0, sexp_of_t, create, trigger, Button];
   runtime.caml_register_global
    (39, Vdom_file_download, cst_Vdom_file_download$0);
   return;
  }
  (globalThis));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLjAsImZpbGUiOiJ2ZG9tX2ZpbGVfZG93bmxvYWQuY21hLmpzIiwic291cmNlUm9vdCI6IiIsIm5hbWVzIjpbImNyZWF0ZSIsImZpbGVuYW1lIiwibWltZXR5cGUiLCJjb250ZW50cyIsInNleHBfb2ZfdCIsInQiLCJ0cmlnZ2VyIiwiYSIsImNvbnRlbnRzX2JpZ3N0ciIsImJsb2IiLCJ1cmwiLCJjcmVhdGUkMCIsIm9wdCIsImdldF9kb3dubG9hZCIsImJ1dHRvbl90ZXh0Iiwic3RoIiwiZW5hYmxlZCIsInN0aCQwIiwib25fY2xpY2siLCJzdGgkMSIsImV4dHJhX2F0dHJzIiwidHJpZ2dlcl9jc3ZfZG93bmxvYWQiLCJldiIsImVuYWJsZWRfZGlzYWJsZWQiLCJhdHRycyJdLCJzb3VyY2VzIjpbIi9ob21lL2xpYW0tY2FycGVudGVyLy5vcGFtL3BlcnNvbmFsLXNpdGUvbGliL2luY3JfZG9tL3Zkb21fZmlsZV9kb3dubG9hZC92ZG9tX2ZpbGVfZG93bmxvYWQubWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztHOzs7OztHOzs7OztHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7WUFVSUEsT0FQQ0MsVUFBQUMsVUFBQUMsVUFBQSxXQUFBRixVQUFBQyxVQUFBQztHQUFDO1lBUUZDLFVBQVVDLEdBQUksV0FBVSwyQkFBZEEsT0FBcUQ7WUFFL0RDO1FBQThCSCxxQkFBVkQscUJBQVZEO0lBQ1o7O2tEQURnQ0U7dURBQVZEO3VEQUFWRDs7Ozs7O0lBUUY7S0FBSk0sSUFBSTtLQUUrQixNQUFBLHFDQVZUSjtLQVMxQkssa0JBQ0Y7S0FFRUM7T0FJRjs7YUFoQmtCUDs7NkJBU2hCTTs7S0FTQUUsTUFBTSx1QkFOTkQ7SUFKQUYsdUJBVUFHO0lBVkFILDJCQVltQyxnQ0FwQjdCTjtJQVFOTTs7bUNBVUFHOztZQVFGQyxTQUNBQyxlQUdEQyxjQUNBQztJQUdELEdBUEVGLFNBQVVHLE1BQVZILFFBQUFJLFVBQVVELGNBQVZDO0lBT0Y7U0FOYUMsZ0JBQVhDLFdBQVdEOztTQUFYQywyQkFBb0IsNkJBQWtCO0lBTXhDLFlBTGdCQyxnQkFBZEMsY0FBY0QsZ0JBQWRDO2FBTUVDLHFCQUFxQkM7S0FuQ3pCaEIsUUFvQ1UsV0FOVE87S0FNQyxPQUFBLFdBUkFLLFVBT3VCSTtJQUVaO0lBRWIsR0FaRU47U0FZRU87O0tBQ2tEO01BQUEsTUFBQTtnQkFBWDtNQUR2Q0E7SUFJRjtLQUFBOztRQWRBSDs7U0FVRUc7O2NBSWlDLG9DQVJqQ0Y7O0tBT0FHLFFBQ0Y7S0FHbUQsVUFBRSxnQ0FmdERWO0tBZWtCLGNBQUUsb0NBSmpCVTtJQUlpRCxPQUFBO0dBQXlCO0dBckJsRSxpQkFDVmI7Ozs7O2dDQTVCRlAsV0FEQUosUUFHQU07Ozs7RSIsInNvdXJjZXNDb250ZW50IjpbIm9wZW4gQ29yZVxub3BlbiBWaXJ0dWFsX2RvbVxuXG50eXBlIHQgPVxuICB7IGZpbGVuYW1lIDogc3RyaW5nXG4gIDsgbWltZXR5cGUgOiBzdHJpbmdcbiAgOyBjb250ZW50cyA6IHN0cmluZ1xuICB9XG5bQEBkZXJpdmluZyBmaWVsZHMgfml0ZXJhdG9yczpjcmVhdGVdXG5cbmxldCBjcmVhdGUgPSBGaWVsZHMuY3JlYXRlXG5sZXQgc2V4cF9vZl90IHQgPSBTZXhwLkF0b20gKHNwcmludGYgXCI8ZG93bmxvYWRlcjogJXM+XCIgdC5maWxlbmFtZSlcblxubGV0IHRyaWdnZXIgeyBmaWxlbmFtZTsgbWltZXR5cGU7IGNvbnRlbnRzIH0gPVxuICBsZXQgb3BlbiBKc19vZl9vY2FtbCBpblxuICBpZiBQcHhfaW5saW5lX3Rlc3RfbGliLmFtX3J1bm5pbmdcbiAgdGhlblxuICAgIHByaW50X3NcbiAgICAgIFslbWVzc2FnZSBcIkRvd25sb2FkIHRyaWdnZXJlZFwiIChmaWxlbmFtZSA6IHN0cmluZykgKG1pbWV0eXBlIDogc3RyaW5nKSBjb250ZW50c11cbiAgZWxzZSAoXG4gICAgKCogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE5MzI4ODkxLzU1ODU5MiAqKVxuICAgIGxldCBhID0gRG9tX2h0bWwuY3JlYXRlQSBEb21faHRtbC5kb2N1bWVudCBpblxuICAgIGxldCBjb250ZW50c19iaWdzdHIgPVxuICAgICAgVHlwZWRfYXJyYXkuQmlnc3RyaW5nLnRvX2FycmF5QnVmZmVyIChCaWdzdHJpbmcub2Zfc3RyaW5nIGNvbnRlbnRzKVxuICAgIGluXG4gICAgbGV0IGJsb2IgPVxuICAgICAgKCogRG9uJ3QgdXNlIFtibG9iX2Zyb21fc3RyaW5nXS4gVGhhdCBoYXMgYW4gYXR0cmFjdGl2ZSB0eXBlIGJ1dCB3b3JrcyBieSBmaXJzdFxuICAgICAgICAgY29udmVydGluZyBvdXIgT0NhbWwgc3RyaW5nIHRvIGEgSmF2YXNjcmlwdCBzdHJpbmcsIHdoaWNoIGNvbnZlcnRzIHRvXG4gICAgICAgICBVVEYtMTYuIElmIHRoZSBzdHJpbmcgY29udGFpbnMgcmFuZG9tIGJpbmFyeSBkYXRhIHRoYXQgd2lsbCBkaXN0b3J0IGl0LiAqKVxuICAgICAgRmlsZS5ibG9iX2Zyb21fYW55IFsgYGFycmF5QnVmZmVyIGNvbnRlbnRzX2JpZ3N0ciBdIH5jb250ZW50VHlwZTptaW1ldHlwZVxuICAgIGluXG4gICAgbGV0IHVybCA9IERvbV9odG1sLndpbmRvdyMjLl9VUkwjI2NyZWF0ZU9iamVjdFVSTCBibG9iIGluXG4gICAgYSMjc2V0QXR0cmlidXRlIChKcy5zdHJpbmcgXCJocmVmXCIpIHVybDtcbiAgICBhIyNzZXRBdHRyaWJ1dGUgKEpzLnN0cmluZyBcImRvd25sb2FkXCIpIChKcy5zdHJpbmcgZmlsZW5hbWUpO1xuICAgIGEjI2NsaWNrO1xuICAgIERvbV9odG1sLndpbmRvdyMjLl9VUkwjI3Jldm9rZU9iamVjdFVSTCB1cmwpXG47O1xuXG5tb2R1bGUgQnV0dG9uID0gc3RydWN0XG4gIGxldCBjcmVhdGVcbiAgICA/KGVuYWJsZWQgPSB0cnVlKVxuICAgID8ob25fY2xpY2sgPSBmdW4gXyAtPiBWZG9tLkVmZmVjdC5JZ25vcmUpXG4gICAgPyhleHRyYV9hdHRycyA9IFtdKVxuICAgIH5nZXRfZG93bmxvYWRcbiAgICB+YnV0dG9uX3RleHRcbiAgICAoKVxuICAgID1cbiAgICBsZXQgb3BlbiBWZG9tIGluXG4gICAgbGV0IHRyaWdnZXJfY3N2X2Rvd25sb2FkIGV2ID1cbiAgICAgIHRyaWdnZXIgKGdldF9kb3dubG9hZCAoKSk7XG4gICAgICBvbl9jbGljayBldlxuICAgIGluXG4gICAgbGV0IGVuYWJsZWRfZGlzYWJsZWQgPVxuICAgICAgaWYgZW5hYmxlZCB0aGVuIFtdIGVsc2UgWyBBdHRyLmRpc2FibGVkOyBBdHRyLnN0eWxlIChDc3NfZ2VuLmNvbG9yIChgTmFtZSBcImdyZXlcIikpIF1cbiAgICBpblxuICAgIGxldCBhdHRycyA9XG4gICAgICBbIGV4dHJhX2F0dHJzOyBlbmFibGVkX2Rpc2FibGVkOyBbIEF0dHIub25fY2xpY2sgdHJpZ2dlcl9jc3ZfZG93bmxvYWQgXSBdXG4gICAgICB8PiBMaXN0LmNvbmNhdFxuICAgIGluXG4gICAgTm9kZS5idXR0b24gfmF0dHJzOlsgQXR0ci5tYW55X3dpdGhvdXRfbWVyZ2UgYXR0cnMgXSBbIE5vZGUudGV4dCBidXR0b25fdGV4dCBdXG4gIDs7XG5lbmRcbiJdfQ==
