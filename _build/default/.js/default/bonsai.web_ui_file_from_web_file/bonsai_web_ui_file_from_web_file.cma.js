// Generated by js_of_ocaml
//# buildInfo:effects=false, kind=cma, use-js-string=true, version=5.6.0

//# unitInfo: Provides: Bonsai_web_ui_file_from_web_file
//# unitInfo: Requires: Async_kernel__Ivar, Bonsai_web, Bonsai_web_ui_file, Core, Core__Error, Js_of_ocaml__Dom, Js_of_ocaml__File, Js_of_ocaml__Js, Js_of_ocaml__Typed_array, Ppx_bench_lib__Benchmark_accumulator, Ppx_expect_runtime, Ppx_inline_test_lib, Ppx_module_timer_runtime, Sexplib0__Sexp_conv, Ui_effect
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Bonsai_web_ui_file_from_we$0 = "Bonsai_web_ui_file_from_web_file",
    cst_bonsai_web_ui_file_from_we$0 = "bonsai_web_ui_file_from_web_file",
    cst_code = "code",
    cst_message = "message",
    caml_string_of_jsstring = runtime.caml_string_of_jsstring;
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    Sexplib0_Sexp_conv = global_data.Sexplib0__Sexp_conv,
    Js_of_ocaml_File = global_data.Js_of_ocaml__File,
    Js_of_ocaml_Js = global_data.Js_of_ocaml__Js,
    Js_of_ocaml_Typed_array = global_data.Js_of_ocaml__Typed_array,
    Async_kernel_Ivar = global_data.Async_kernel__Ivar,
    Core = global_data.Core,
    Core_Error = global_data.Core__Error,
    Ui_effect = global_data.Ui_effect,
    Js_of_ocaml_Dom = global_data.Js_of_ocaml__Dom,
    Bonsai_web = global_data.Bonsai_web,
    Bonsai_web_ui_file = global_data.Bonsai_web_ui_file,
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Ppx_expect_runtime = global_data.Ppx_expect_runtime,
    Ppx_inline_test_lib = global_data.Ppx_inline_test_lib;
   caml_call1(Ppx_module_timer_runtime[4], cst_Bonsai_web_ui_file_from_we$0);
   caml_call1
    (Ppx_bench_lib_Benchmark_accumu[1][1], cst_bonsai_web_ui_file_from_we$0);
   caml_call1
    (Ppx_expect_runtime[1][1],
     "web_ui/file/from_web_file/bonsai_web_ui_file_from_web_file.ml");
   caml_call2
    (Ppx_inline_test_lib[6],
     cst_bonsai_web_ui_file_from_we$0,
     "bonsai_web_ui_file_from_web_file.ml");
   var
    cst_BUG_could_not_coerce_fileR =
      "BUG: could not coerce fileReader result to arrayBuffer",
    _a_ = [0, cst_message],
    _b_ = [0, cst_code],
    cst_Error_reading_file = "Error reading file",
    cst_bonsai_web_ui_file_from_we = cst_bonsai_web_ui_file_from_we$0,
    cst_Bonsai_web_ui_file_from_we = cst_Bonsai_web_ui_file_from_we$0;
   function create(file){
    function _c_(on_progress){
     var
      file_reader = new Js_of_ocaml_File[6],
      result = caml_call1(Async_kernel_Ivar[12], 0),
      _e_ = 0;
     function _f_(param){
      function call_on_progress(ev){
       var _q_ = ev.lengthComputable | 0;
       if(! _q_) return _q_;
       var _r_ = caml_call1(on_progress, [0, ev.loaded, ev.total]);
       return caml_call1(Ui_effect[21][2], _r_);
      }
      function _i_(ev){call_on_progress(ev); return Js_of_ocaml_Js[7];}
      var t4 = caml_call1(Js_of_ocaml_Dom[10], _i_);
      file_reader.onprogress = t4;
      function _j_(ev){
       var
        _n_ =
          [0,
           [1,
            [0,
             _a_,
             [0,
              caml_call1
               (Sexplib0_Sexp_conv[7],
                caml_string_of_jsstring(file_reader.error.message)),
              0]]],
           0],
        t7 = file_reader.error,
        _o_ = [0, [1, [0, _b_, [0, caml_call1(Core[389], t7.code), 0]]], _n_],
        _p_ =
          [1,
           [0, caml_call1(Sexplib0_Sexp_conv[7], cst_Error_reading_file), _o_]],
        error = caml_call1(Core_Error[20], _p_);
       caml_call2(Async_kernel_Ivar[16], result, [1, [0, error]]);
       return Js_of_ocaml_Js[7];
      }
      var t9 = caml_call1(Js_of_ocaml_Dom[10], _j_);
      file_reader.onerror = t9;
      function _k_(ev){
       call_on_progress(ev);
       var
        _l_ = caml_call1(Js_of_ocaml_File[3][5], file_reader.result),
        match = caml_call1(Js_of_ocaml_Js[5][10], _l_);
       if(match){
        var
         array_buffer = match[1],
         contents = caml_call1(Js_of_ocaml_Typed_array[50][3], array_buffer);
        caml_call2(Async_kernel_Ivar[16], result, [0, contents]);
       }
       else{
        var
         _m_ =
           caml_call1(Sexplib0_Sexp_conv[7], cst_BUG_could_not_coerce_fileR);
        caml_call1(Core[261], _m_);
       }
       return Js_of_ocaml_Js[7];
      }
      var t12 = caml_call1(Js_of_ocaml_Dom[10], _k_);
      file_reader.onload = t12;
      file_reader.readAsArrayBuffer(file);
      return caml_call1(Async_kernel_Ivar[19], result);
     }
     var result$0 = caml_call2(Bonsai_web[5][24], _f_, _e_), _g_ = 0;
     function _h_(param){return file_reader.abort();}
     var abort = caml_call2(Ui_effect[17], _h_, _g_);
     return [0, result$0, abort];
    }
    var
     read = caml_call1(Ui_effect[17], _c_),
     _d_ = caml_string_of_jsstring(caml_call1(Js_of_ocaml_File[5], file));
    return caml_call2(Bonsai_web_ui_file[10][1], read, _d_);
   }
   caml_call1(Ppx_inline_test_lib[7], cst_bonsai_web_ui_file_from_we);
   caml_call1(Ppx_expect_runtime[1][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Bonsai_web_ui_file_from_we);
   var Bonsai_web_ui_file_from_web_fi = [0, create];
   runtime.caml_register_global
    (39, Bonsai_web_ui_file_from_web_fi, cst_Bonsai_web_ui_file_from_we$0);
   return;
  }
  (globalThis));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLjAsImZpbGUiOiJib25zYWlfd2ViX3VpX2ZpbGVfZnJvbV93ZWJfZmlsZS5jbWEuanMiLCJzb3VyY2VSb290IjoiIiwibmFtZXMiOlsiY3JlYXRlIiwiZmlsZSIsIm9uX3Byb2dyZXNzIiwicmVzdWx0IiwiY2FsbF9vbl9wcm9ncmVzcyIsImV2IiwiZXJyb3IiLCJhcnJheV9idWZmZXIiLCJjb250ZW50cyIsInJlc3VsdCQwIiwiYWJvcnQiLCJyZWFkIl0sInNvdXJjZXMiOlsiL2hvbWUvbGlhbS1jYXJwZW50ZXIvLm9wYW0vcGVyc29uYWwtc2l0ZS9saWIvYm9uc2FpL3dlYl91aV9maWxlX2Zyb21fd2ViX2ZpbGUvYm9uc2FpX3dlYl91aV9maWxlX2Zyb21fd2ViX2ZpbGUubWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztHOzs7OztHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztZQUlJQSxPQUFPQztpQkFFb0JDO0tBQ3pCOztNQUNJQyxTQUFTO01BQUE7O2VBSUhDO09BQ0M7T0FBQSxVQUFBO09BRUQsVUFBQSxXQVRlRjtPQVNmLE9BQUE7TUFFMEI7bUJBR1JHLElBUmxCRCxpQkFRa0JDLEtBQ2YseUJBQ1E7TUFGVixTQUFBOzttQkFJaUJBO09BQ2Y7Ozs7Ozs7OztnQkFNVTs7Ozs7Ozs7UUFOTkMsUUFDRjtPQVFGLGtDQTFCVEgsZ0JBaUJhRztPQVNKO01BR1E7TUFiVixTQUFBOzttQkFlaUJEO09BM0JsQkQsaUJBMkJrQkM7T0FHWjtRQUFBLE1BQUE7UUFBQSxRQUFBOztRQVNlO1NBRFZFO1NBQ0RDLFdBQVcsMkNBRFZEO1FBRUwsa0NBNUNaSixZQTJDZ0JLOzs7Ozs7UUFKSjs7T0FNSDtNQUFRO01BZFYsVUFBQTs7TUFlTCw4QkFsRERQO01BS0wsT0FBQSxrQ0FESUU7S0ErQ2tCO0tBN0NwQixJQURFTSxXQUNGLHlDQUFBO3lCQWdEMkMsMkJBQWtCO0tBQW5ELElBQVJDLFFBQVE7S0FDWixXQWxESUQsVUFpREFDO0lBQ3VDO0lBckQ3QztLQURFQyxPQUNGO0tBdUQrQyxNQUFBLHdCQUFDLGdDQXpEekNWO0lBeUR3QyxPQUFBLHNDQXhEN0NVO0dBd0RpRjs7Ozs7NENBekRuRlg7Ozs7RSIsInNvdXJjZXNDb250ZW50IjpbIm9wZW4gQ29yZVxub3BlbiBBc3luY19rZXJuZWxcbm9wZW4gSnNfb2Zfb2NhbWxcblxubGV0IGNyZWF0ZSBmaWxlID1cbiAgbGV0IHJlYWQgPVxuICAgIFVpX2VmZmVjdC5vZl9zeW5jX2Z1biAoZnVuIG9uX3Byb2dyZXNzIC0+XG4gICAgICBsZXQgZmlsZV9yZWFkZXIgPSBuZXclanMgRmlsZS5maWxlUmVhZGVyIGluXG4gICAgICBsZXQgcmVzdWx0ID0gSXZhci5jcmVhdGUgKCkgaW5cbiAgICAgIGxldCByZXN1bHQgPVxuICAgICAgICBCb25zYWlfd2ViLkVmZmVjdC5vZl9kZWZlcnJlZF9mdW5cbiAgICAgICAgICAoZnVuICgpIC0+XG4gICAgICAgICAgICBsZXQgY2FsbF9vbl9wcm9ncmVzcyBldiA9XG4gICAgICAgICAgICAgIGlmIEpzLnRvX2Jvb2wgZXYjIy5sZW5ndGhDb21wdXRhYmxlXG4gICAgICAgICAgICAgIHRoZW5cbiAgICAgICAgICAgICAgICBvbl9wcm9ncmVzc1xuICAgICAgICAgICAgICAgICAgeyBCb25zYWlfd2ViX3VpX2ZpbGUuUHJvZ3Jlc3MubG9hZGVkID0gZXYjIy5sb2FkZWQ7IHRvdGFsID0gZXYjIy50b3RhbCB9XG4gICAgICAgICAgICAgICAgfD4gVWlfZWZmZWN0LkV4cGVydC5oYW5kbGVcbiAgICAgICAgICAgIGluXG4gICAgICAgICAgICBmaWxlX3JlYWRlciMjLm9ucHJvZ3Jlc3NcbiAgICAgICAgICAgICAgOj0gRG9tLmhhbmRsZXIgKGZ1biBldiAtPlxuICAgICAgICAgICAgICAgICAgIGNhbGxfb25fcHJvZ3Jlc3MgZXY7XG4gICAgICAgICAgICAgICAgICAgSnMuX3RydWUpO1xuICAgICAgICAgICAgZmlsZV9yZWFkZXIjIy5vbmVycm9yXG4gICAgICAgICAgICAgIDo9IERvbS5oYW5kbGVyIChmdW4gX2V2IC0+XG4gICAgICAgICAgICAgICAgICAgbGV0IGVycm9yID1cbiAgICAgICAgICAgICAgICAgICAgIEVycm9yLmNyZWF0ZV9zXG4gICAgICAgICAgICAgICAgICAgICAgIFslbWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICAgICAgIFwiRXJyb3IgcmVhZGluZyBmaWxlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH5jb2RlOihmaWxlX3JlYWRlciMjLmVycm9yIyMuY29kZSA6IGludClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH5tZXNzYWdlOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoSnMudG9fc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChKcy5VbnNhZmUuZ2V0IGZpbGVfcmVhZGVyIyMuZXJyb3IgKEpzLnN0cmluZyBcIm1lc3NhZ2VcIikpKV1cbiAgICAgICAgICAgICAgICAgICBpblxuICAgICAgICAgICAgICAgICAgIEl2YXIuZmlsbF9pZl9lbXB0eVxuICAgICAgICAgICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgICAgICAgICAgICAoRXJyb3IgKEJvbnNhaV93ZWJfdWlfZmlsZS5SZWFkX2Vycm9yLkVycm9yIGVycm9yKSk7XG4gICAgICAgICAgICAgICAgICAgSnMuX3RydWUpO1xuICAgICAgICAgICAgZmlsZV9yZWFkZXIjIy5vbmxvYWRcbiAgICAgICAgICAgICAgOj0gRG9tLmhhbmRsZXIgKGZ1biBldiAtPlxuICAgICAgICAgICAgICAgICAgIGNhbGxfb25fcHJvZ3Jlc3MgZXY7XG4gICAgICAgICAgICAgICAgICAgKG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgZmlsZV9yZWFkZXIjIy5yZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICB8PiBGaWxlLkNvZXJjZVRvLmFycmF5QnVmZmVyXG4gICAgICAgICAgICAgICAgICAgICAgfD4gSnMuT3B0LnRvX29wdGlvblxuICAgICAgICAgICAgICAgICAgICB3aXRoXG4gICAgICAgICAgICAgICAgICAgIHwgTm9uZSAtPlxuICAgICAgICAgICAgICAgICAgICAgIHJhaXNlX3NcbiAgICAgICAgICAgICAgICAgICAgICAgIFslbWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICBcIkJVRzogY291bGQgbm90IGNvZXJjZSBmaWxlUmVhZGVyIHJlc3VsdCB0byBhcnJheUJ1ZmZlclwiXVxuICAgICAgICAgICAgICAgICAgICB8IFNvbWUgYXJyYXlfYnVmZmVyIC0+XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnRlbnRzID0gVHlwZWRfYXJyYXkuQmlnc3RyaW5nLm9mX2FycmF5QnVmZmVyIGFycmF5X2J1ZmZlciBpblxuICAgICAgICAgICAgICAgICAgICAgIEl2YXIuZmlsbF9pZl9lbXB0eSByZXN1bHQgKE9rIGNvbnRlbnRzKSk7XG4gICAgICAgICAgICAgICAgICAgSnMuX3RydWUpO1xuICAgICAgICAgICAgZmlsZV9yZWFkZXIjI3JlYWRBc0FycmF5QnVmZmVyIGZpbGU7XG4gICAgICAgICAgICBJdmFyLnJlYWQgcmVzdWx0KVxuICAgICAgICAgICgpXG4gICAgICBpblxuICAgICAgbGV0IGFib3J0ID0gVWlfZWZmZWN0Lm9mX3N5bmNfZnVuIChmdW4gKCkgLT4gZmlsZV9yZWFkZXIjI2Fib3J0KSAoKSBpblxuICAgICAgeyBCb25zYWlfd2ViX3VpX2ZpbGUuRXhwZXJ0LnJlc3VsdDsgYWJvcnQgfSlcbiAgaW5cbiAgQm9uc2FpX3dlYl91aV9maWxlLkV4cGVydC5jcmVhdGUgfnJlYWQgfmZpbGVuYW1lOihGaWxlLmZpbGVuYW1lIGZpbGUgfD4gSnMudG9fc3RyaW5nKVxuOztcbiJdfQ==
